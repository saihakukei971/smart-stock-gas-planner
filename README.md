# 仕込み量予測システム

## 📋 システム概要

「仕込み量予測システム」は、小売・飲食・サービス業向けの仕込み量および発注量の予測支援システムです。Google SpreadsheetとGoogle Apps Script(GAS)を活用し、外部データ（天気、SNS、イベント情報等）と過去の売上実績を組み合わせることで、精度の高い予測を低コストで実現します。

### 🌟 主な特徴
- **外部要因との連携**: 天候、SNS言及数、イベントなど30種類のAPIと連携可能
- **低コスト**: 高価なAIシステムを導入せず、Googleの無料サービスをベースに構築
- **現場視点**: 完全自動化ではなく、現場の判断を支援する設計思想
- **簡易操作**: 専門知識がなくても使いこなせるシンプルなインターフェース
- **柔軟なカスタマイズ**: 業種・業態に合わせたルール設定が可能

## 🛠️ システム構成

### スプレッドシート構成
本システムは以下9つのシートで構成されています：

#### 1. 外部データシート
**目的**: 外部APIから取得したデータの保存・表示
**列構成**:
- A列: 日付 (yyyy/MM/dd形式)
- B列: 気温 (数値、℃単位)
- C列: 降水確率 (パーセント表示)
- D列: UV指数 (数値)
- E列: SNS件数 (整数値)
- F列: 給料日前 (チェックボックス形式、TRUE/FALSE)
- G列: イベント名 (テキスト)
- H列: 人流指数 (数値)
- I列: 祝日 (チェックボックス形式、TRUE/FALSE)
- J列: 天気概要 (テキスト)

**データ更新方法**: GASスクリプトによる自動更新(6:00AM)または手動更新
**保存期間**: 直近3ヶ月分のデータを保持
**特記事項**: 各APIのデータ取得状況はAPIログシートに記録

#### 2. 売上履歴シート
**目的**: 日別・メニュー別・時間帯別の売上データを記録
**列構成**:
- A列: 日付 (yyyy/MM/dd形式)
- B列: 曜日 (日、月、火、水、木、金、土)
- C列: 時間帯 (朝、昼、夜のいずれか)
- D列: メニュー名 (冷麺、カレー、唐揚げ、ラーメン、チャーハン)
- E列: 販売数 (整数値)
- F列: 廃棄数 (整数値)
- G列: 金額 (通貨形式、¥)

**入力タイミング**: 営業終了後に当日データを入力
**データ検証**: 時間帯とメニュー名にはドロップダウンリストを設定
**集計機能**: メニュー別・時間帯別の集計は年間傾向シートで実施
**特記事項**: 過去データのインポート機能あり(GAS)

#### 3. ルール一覧シート
**目的**: 条件判断と生成コメントの設定を管理
**列構成**:
- A列: No (連番)
- B列: 条件対象 (気温、降水確率、SNS件数など)
- C列: 比較値 (数値または論理値)
- D列: 演算子 (>, >=, '=, <, <=)
- E列: 外部データ列 (外部データシートの列名)
- F列: 出力コメント例 (条件に合致した際に表示するテキスト)

**注意点**: '='は「'=」と入力してテキスト化
**設定例**:
1. 気温 > 28℃ → 冷たいメニューを増やす
2. 降水確率 >= 50% → 来客数減少の可能性
3. SNS件数 >= 60 → 人気メニューの準備増加
4. 給料日前 = TRUE → 客単価上昇見込み
5. 祝日 = TRUE → 来客増加可能性
6. 気温 < 15℃ → 温かいメニュー増量
7. 人流指数 > 100 → 混雑に備える

**運用**: 店長会議で定期的に見直し・更新

#### 4. 提案結果シート
**目的**: システムが算出した予測結果を表示
**列構成**:
- A列: 日付 (yyyy/MM/dd形式)
- B列: メニュー名 (冷麺、カレー、唐揚げ、ラーメン、チャーハン)
- C列: 提案仕込み数 (整数値)
- D列: コメント (予測根拠を説明するテキスト)

**生成タイミング**: 毎朝6:10に自動生成または手動で生成
**表示形式**: 日付別・メニュー別にグループ化
**コメント内容**: 影響要因(気温、SNS、イベントなど)と販売予測の根拠
**予測方法**: 外部データとルール一覧を照合し、salesHistoryとの相関を考慮

#### 5. 手動修正欄シート
**目的**: 店長による提案内容の最終調整
**列構成**:
- A列: 日付 (yyyy/MM/dd形式)
- B列: メニュー名 (冷麺、カレー、唐揚げ、ラーメン、チャーハン)
- C列: 提案仕込み数 (整数値、提案結果シートから自動転記)
- D列: 手動修正数 (整数値)
- E列: 修正理由 (テキスト、修正時に入力)

**運用方法**:
- 提案結果生成後、必要に応じて修正
- 空欄の場合は提案仕込み数がそのまま採用
- 修正理由は引継ぎ・データ分析のため必ず入力
- 最終的な仕込み指示はこのシートの値を使用

#### 6. 判断支援シート
**目的**: 仕込み数以外の重要な判断材料や警告を提供
**列構成**:
- A列: 日付 (yyyy/MM/dd形式)
- B列: 警戒対象 (冷房強化、雨対策、給料日対応など)
- C列: コメント (具体的な対応策や注意点)

**生成方法**: 外部データとルール一覧から自動生成
**活用例**: ミーティングでの注意喚起、シフト調整の判断材料

#### 7. 年間傾向シート
**目的**: 販売データの長期トレンドを可視化
**構成**:
- 冷麺の月別推移グラフ (列グラフ)
- カレーの月別推移グラフ (折れ線グラフ)
- 唐揚げの月別推移グラフ (面グラフ)
- 曜日別売上傾向 (円グラフ)
- 気温と冷麺販売数の相関 (散布図+近似曲線)
- 全メニューの月別推移比較 (複合折れ線グラフ)

**データ範囲**: 過去12ヶ月分のデータ集計
**更新頻度**: 週1回自動更新(月曜9:00AM)
**活用方法**: 店長会議での傾向分析、季節メニュー計画の判断材料

#### 8. APIログシート
**目的**: API連携の状況と結果を記録
**列構成**:
- A列: 日時 (yyyy/MM/dd HH:mm:ss形式)
- B列: API名 (OpenWeatherMap、Twitter/X APIなど)
- C列: ステータス (成功/失敗)
- D列: 応答時間(ms) (整数値)
- E列: エラーメッセージ (エラー発生時のメッセージ)
- F列: データサンプル (取得データのサンプル)

**記録タイミング**: API呼び出し直後に自動記録
**保存期間**: 30日分を保持し、古いものから自動削除
**トラブルシューティング**: API連携エラー時の原因特定に使用

#### 9. 設定シート
**目的**: システム全体の設定値を管理
**セクション構成**:
1. **店舗情報**
   - 店舗名: 〇〇店
   - 住所: 東京都〇〇区〇〇町1-2-3
   - 責任者: 山田太郎
   - 営業時間: 11:00-22:00

2. **メニュー設定**
   - メニューリスト: 冷麺,カレー,唐揚げ,ラーメン,チャーハン
   - メニュー単価: 700,800,750,850,700

3. **API設定**
   - 天気API: OpenWeatherMap
   - SNS API: Twitter/X API
   - UV指数API: OpenUV API
   - 祝日API: Google Calendar API

4. **通知設定**
   - メール通知: ✓
   - メールアドレス: example@example.com
   - LINE通知: ✓
   - LINEトークン: xxxxxxxxxxxxxxxxxxxxxxxx

5. **実行設定**
   - 自動実行時刻: 06:00
   - 予測実行: 06:10
   - レポート生成: 月曜 09:00

**アクセス制限**: 一般スタッフは閲覧のみ、店長以上は編集可能
**変更記録**: 設定変更は自動でログ記録される
**初期設定**: システム導入時にGASスクリプトで自動生成

### Google Apps Script(GAS)機能一覧

#### 1. apiHandlers.gs: 各種API連携処理
- 天気情報取得(OpenWeatherMap)
- SNS投稿数取得(Twitter/X API)
- UV指数取得(OpenUV API)
- 祝日判定(Google Calendar API)
- LINE通知送信

#### 2. dataProcessor.gs: データ加工・分析
- 過去販売データの集計
- 曜日・天候別の販売傾向分析
- 相関係数計算

#### 3. forecastEngine.gs: 予測エンジン
- ルールベース判定
- 外部要因の重み付け計算
- 提案仕込み数算出
- 判断支援コメント生成

#### 4. outputManager.gs: 出力管理
- 予測結果のシート出力
- メール通知
- LINE通知
- PDFレポート生成

#### 5. scheduler.gs: 実行スケジューラ
- 自動実行トリガー管理
- API呼び出し分散実行
- エラー通知

#### 6. utilities.gs: ユーティリティ関数
- 日付処理
- キャッシュ管理
- ログ記録
- 実行時間監視

## 🚀 導入手順

### 前提条件
- Googleアカウント
- インターネット接続環境
- スマートフォンまたはPC（閲覧用）

### 基本手順
1. **テンプレートの複製**
   - 提供されたテンプレートをGoogleドライブに複製
   - ファイル名を店舗名などに変更

2. **初期設定**
   - 「設定」シートで店舗情報、メニュー情報を入力
   - APIキーの取得と設定（任意、使用するAPIのみ）
   - スクリプトエディタで実行許可の設定

3. **基礎データ入力**
   - 過去2週間分以上の売上データを「売上履歴」シートに入力
   - 「ルール一覧」に基本ルールを設定

4. **自動実行の設定**
   - スプレッドシートメニューから「🔮 仕込み予測」→「システム初期設定」を実行
   - トリガー設定の確認（毎朝6:00自動実行など）

5. **テスト運用**
   - 手動で「今日の予測実行」を試す
   - 予測結果と実際の必要量を1週間並行記録
   - 差異に基づくルール調整

## 📋 運用マニュアル

### ⏰ 日次運用手順

#### 朝（出勤時）
1. **予測確認**
   - 「提案結果」シートを開く
   - 本日の日付の予測を確認
   - 「判断支援」シートで特記事項を確認

2. **仕込み数の微調整**
   - 「手動修正欄」シートを開く
   - 必要に応じて「手動修正数」を調整
   - 変更理由を入力（引継ぎのため）

3. **仕込み指示**
   - 最終的な仕込み数をスタッフに伝達
   - 「判断支援」の内容に基づき、特記事項を共有

#### 閉店時
1. **実績入力**
   - 「売上履歴」シートを開く
   - 当日の販売数、廃棄数、金額を入力
   - 時間帯別（朝・昼・夜）に分けて入力

2. **特記事項メモ**
   - 予測と大きく違った場合はその理由をメモ
   - 翌日以降の参考にするため

### 📅 週次運用手順

#### 月曜日
1. **週間レポート確認**
   - 自動生成された週間レポートをメールで確認
   - 過去1週間の傾向を確認

2. **年間傾向の確認**
   - 「年間傾向」シートを開く
   - トレンドの変化を確認（上昇/下降）

3. **翌週の特別要因確認**
   - 翌週のイベント、休日などを確認
   - 必要に応じて追加情報を「設定」シートに入力

#### 金曜日
1. **週末対策確認**
   - 週末（土日）の予測を先行確認
   - 特別な準備が必要な場合は事前に対応

2. **在庫確認**
   - 週末向けの食材発注が適切か確認
   - 予測数量に基づく必要量を計算

### 📊 月次運用手順

#### 月初め
1. **前月振り返り**
   - 「年間傾向」シートで前月のパフォーマンスを確認
   - 予測精度、廃棄率などの指標を分析

2. **ルール見直し**
   - 「ルール一覧」シートの内容を見直し
   - 季節変化などを踏まえたルール調整（必要な場合）

3. **メニュー見直し**
   - 「設定」シートのメニューリストを確認
   - 季節メニューの追加/削除を検討

## 🧑‍🍳 現場での使い方ガイド

### 📱 店長向け操作手順（詳細版）

#### 基本操作
1. **システムへのアクセス**
   - パソコンまたはスマホでGoogleスプレッドシートを開く
   - 「仕込み量予測システム」を選択
   - 初回は「共有」設定で自分のGoogleアカウントにアクセス権限があるか確認

2. **日々の予測確認手順**
   - ①「提案結果」シートをタップ
   - ②本日の日付の行を探す（一番上に表示されるはず）
   - ③各メニューの「提案仕込み数」を確認
   - ④「コメント」列で予測根拠を確認

3. **修正方法**
   - ①「手動修正欄」シートをタップ
   - ②各メニューの「手動修正数」セルをタップして編集
   - ③変更した理由を「修正理由」セルに入力
   - ④変更しない項目はそのまま空欄（提案値が採用される）

4. **日別注意点確認**
   - ①「判断支援」シートをタップ
   - ②本日の特記事項を確認
   - ③重要な警戒項目は色付きで表示

#### トラブルシューティング
1. **予測が表示されない場合**
   - ①「APIログ」シートで最新のログを確認
   - ②「失敗」ステータスがないか確認
   - ③「設定」シートのAPI設定が正しいか確認
   - ④手動で予測実行: メニューから「🔮 仕込み予測」→「今日の予測実行」をクリック

2. **手動修正値が反映されない場合**
   - ①通信状況を確認（オフライン時は同期されない）
   - ②誤って別のセルを編集していないか確認
   - ③修正後にEnterキーを押したか確認

3. **異常な予測値への対応**
   - ①「外部データ」シートで気温や降水確率などが正常か確認
   - ②明らかに異常な場合は手動修正欄で適切な値に調整
   - ③問題があれば「修正理由」に「異常値のため調整」と記入

### 🧑‍💼 スタッフ向け簡易マニュアル

#### 日々の確認事項
1. **最終仕込み数の確認方法**
   - 「手動修正欄」シートを開く
   - 今日の日付の「手動修正数」列を確認
   - 空欄の場合は「提案仕込み数」を確認

2. **特記事項の確認**
   - 「判断支援」シートを開く
   - 今日の「警戒対象」と「コメント」を確認
   - 色付き背景の項目は特に重要

3. **実績入力手順**
   - 「売上履歴」シートを開く
   - 最終行に新しいデータを入力
   - 各項目（日付、曜日、時間帯、メニュー名、販売数、廃棄数、金額）を正確に入力
   - 金額は「単価×販売数」で計算（自動計算ではない）

## 🔍 トラブルシューティング

### よくある問題と解決法
1. **予測が表示されない**
   - APIログを確認し、エラー内容を特定
   - API키ーの有効期限と制限を確認
   - 手動で「今日の予測実行」を試す

2. **予測精度が低い**
   - 「ルール一覧」の条件と比較値を見直す
   - 外部データの取得状況を確認
   - 過去データの正確性を検証

3. **シートが重くなる**
   - 古いデータのアーカイブを検討
   - 不要なシートを非表示に
   - グラフ数を最適化

4. **権限エラーが出る**
   - スクリプトの実行許可を再確認
   - APIアクセス権限の更新
   - Googleアカウントのログイン状態確認

## 💡 よくある質問と回答

1. **Q: 予測と実際の来客数が大きく異なった場合はどうすればいいですか？**  
   A: 「手動修正欄」で適切な値に調整し、「修正理由」に状況を記録してください。この情報はシステムの学習には直接使われませんが、引継ぎや振り返りの際に役立ちます。

2. **Q: 特別なイベントがある日はどう対応すればいいですか？**  
   A: 「外部データ」シートの「イベント名」欄に情報を入力すると、予測に反映されます。また、「手動修正欄」で直接調整することも可能です。

3. **Q: メニューを追加/変更したい場合はどうすればいいですか？**  
   A: 「設定」シートの「メニュー設定」セクションでメニューリストを編集してください。システム管理者に連絡し、GASコードの更新も依頼してください。

4. **Q: 予測の根拠を詳しく知りたい場合はどうすればいいですか？**  
   A: 「提案結果」シートの「コメント」列に簡易説明があります。より詳細な分析は「年間傾向」シートで確認できます。

5. **Q: スプレッドシートが重くなったらどうすればいいですか？**  
   A: 年に1回程度、「売上履歴」と「APIログ」シートの古いデータ（1年以上前）をアーカイブ（別シートにコピーして削除）することをお勧めします。

## 📋 初期設定チェックリスト

- [ ] スプレッドシートの共有設定を確認
- [ ] 「設定」シートの店舗情報を入力
- [ ] 「設定」シートのメニュー設定を確認
- [ ] 「設定」シートのAPI設定を確認
- [ ] 「設定」シートの通知設定を確認
- [ ] サンプルデータ生成で動作確認
- [ ] 実際のメニューで手動修正テスト
- [ ] スマホからのアクセス確認

## 実際のレイアウト例などは以下のリンクに記載しております。
https://docs.google.com/spreadsheets/d/1BrNdoH9mWbOpe_UjAyYySxzDBKEDxk2HboFfS8UfkHY/edit?gid=165285880#gid=165285880



## 🔄 今後の展望

### 開発ロードマップ
1. **2025年Q2予定**
   - モバイルアプリ対応強化
   - 画像認識機能の試験導入（店頭POPからのイベント情報抽出）
   - チーム協業機能の強化

2. **2025年Q3予定**
   - 複数店舗の横断分析機能
   - AIコメント生成の高度化
   - 天気予報の精度向上（複数ソース統合）

3. **2025年Q4予定**
   - 高度なダッシュボード機能
   - データエクスポート機能の拡充
   - 外部会計システム連携
